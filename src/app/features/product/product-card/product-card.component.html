<div
  [routerLink]="['/product', product().id]"
  class="group h-full min-h-[400px] rounded-2xl shadow-sm hover:shadow-lg transition-shadow duration-300 bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 overflow-hidden flex flex-col cursor-pointer"
>
  <div class="relative flex-shrink-0 bg-white dark:bg-gray-900 z-10">
      <swiper-container
        init="false"
        #swiperEl
        slides-per-view="1"
        [loop]="shouldLoop()"
        autoplay-delay="2500"
        autoplay-disable-on-interaction="true"
        pagination="true"
        class="w-full h-64 bg-gray-50 dark:bg-gray-800"
      >
      @for (photo of product().photos; track photo.imageName) {
      <swiper-slide>
        <img
          class="w-full h-64 object-contain p-4"
          [src]="'https://estorex.runasp.net/' + photo.imageName"
          [alt]="product().name"
          loading="lazy"
        />
      </swiper-slide>
      }
    </swiper-container>

    @if (product().oldPrice > product().newPrice && product().oldPrice > 0)
    {
    <div
      class="absolute top-3 left-3 bg-[#007580]/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-md text-xs font-semibold shadow-sm z-20"
    >
      Sale
    </div>
    }
  </div>

  <div class="flex flex-col justify-between flex-1 p-4">
    <div>
        <h4 class="text-sm md:text-base font-medium text-gray-900 dark:text-gray-100 capitalize line-clamp-2 mb-2 group-hover:text-[#007580] transition-colors">
          {{ product().name }}
        </h4>

        <p class="text-lg font-bold text-[#272343] dark:text-[#f7f7f7] flex items-center gap-2">
          {{ product().newPrice | currency : "EGP" : "symbol" }}
          @if (product().oldPrice > 0) {
          <span class="text-sm text-gray-400 line-through font-normal">
            {{ product().oldPrice | currency : "EGP" : "symbol" }}
          </span>
          }
        </p>
    </div>

    <div class="flex items-center gap-3 mt-4 pt-4 border-t border-gray-100 dark:border-gray-800">
      <button
        type="button"
        (click)="$event.stopPropagation(); $event.preventDefault(); addToCart($event)"
        class="flex-1 bg-[#007580] hover:bg-[#00656e] text-white
              py-2 px-3 rounded-xl shadow-sm
              transition-colors flex items-center justify-center gap-1.5
              text-xs font-medium cursor-pointer relative z-20"
      >
        <lucide-icon name="shopping-cart" size="16"></lucide-icon>
        Add to Cart
      </button>      
      <button
        (click)="toggleWishlist($event)"
        class="p-2 rounded-lg border transition-colors cursor-pointer group/heart"
        [ngClass]="{
          'border-red-500 text-red-500 bg-red-50 dark:bg-red-900/10': isInWishlist(),
          'border-gray-200 dark:border-gray-700 text-gray-500 hover:text-red-500 hover:border-red-500 hover:bg-red-50 dark:hover:bg-red-900/10': !isInWishlist()
        }"
        [title]="isInWishlist() ? 'Remove from Wishlist' : 'Add to Wishlist'"
      >
        <lucide-icon 
            name="heart" 
            size="16" 
            [class.fill-red-500]="isInWishlist()"
            class="transition-all duration-300"
        ></lucide-icon>
      </button>
    </div>
  </div>
</div>
