<div
  class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8
         bg-gray-50 dark:bg-gray-900 transition-colors duration-300"
>
  <div class="sm:mx-auto sm:w-full sm:max-w-sm text-center">
    <div
      class="flex justify-center items-center gap-2
             text-2xl font-semibold text-gray-900 dark:text-white"
    >
      <lucide-icon name="Check" class="text-[#029fae]" [size]="32"></lucide-icon>
      <span>Reset Password</span>
    </div>
  </div>

  <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
    <div
      class="bg-white dark:bg-gray-800 rounded-xl
             shadow-lg ring-1 ring-gray-200 dark:ring-gray-700
             px-6 py-8"
    >
      @if (isVerifying()) {
        <div class="flex flex-col items-center justify-center py-8 space-y-4">
          <lucide-icon
            name="Loader2"
            class="animate-spin text-[#029fae]"
            [size]="48"
          ></lucide-icon>
          <p class="text-gray-600 dark:text-gray-300">Verifying link...</p>
        </div>
      } @else if (tokenStatus() === 'invalid') {
        <div class="flex flex-col items-center justify-center py-8 space-y-4">
          <lucide-icon
            name="XCircle"
            class="text-red-500"
            [size]="48"
          ></lucide-icon>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
            Invalid or Expired Link
          </h3>
          <p class="text-center text-sm text-gray-500 dark:text-gray-400">
            {{ errorMessage() || 'This password reset link is invalid or has expired.' }}
          </p>
          <a
            routerLink="/auth/forgot-password"
            class="mt-4 text-[#029fae] hover:text-[#028b99] font-medium"
          >
            Request a new link
          </a>
        </div>
      } @else if (tokenStatus() === 'valid') {
        <form
          [formGroup]="form"
          (ngSubmit)="onSubmit()"
          class="space-y-5"
        >

          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200">
              New Password
            </label>

            <input
              type="password"
              formControlName="newPassword"
              class="input"
              [ngClass]="{
                'ring-red-500':
                  hasError('newPassword','required') ||
                  hasError('newPassword','minlength')
              }"
            />

            @if (hasError('newPassword','required')) {
              <p class="error-text">Password is required.</p>
            }

            @if (hasError('newPassword','minlength')) {
              <p class="error-text">
                Password must be at least 6 characters.
              </p>
            }
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-900 dark:text-gray-200">
              Confirm Password
            </label>

            <input
              type="password"
              formControlName="confirmPassword"
              class="input"
              [ngClass]="{
                'ring-red-500':
                  form.errors?.['passwordMismatch'] &&
                  form.get('confirmPassword')?.dirty
              }"
            />

            @if (
              form.errors?.['passwordMismatch'] &&
              form.get('confirmPassword')?.dirty
            ) {
              <p class="error-text">Passwords do not match.</p>
            }
          </div>

          <button
            type="submit"
            [disabled]="form.invalid || isLoading()"
            class="flex w-full justify-center items-center gap-2
                   rounded-md bg-[#029fae]
                   px-3 py-2 text-sm font-semibold text-white
                   shadow-md hover:shadow-lg
                   hover:bg-[#028b99]
                   transition-all disabled:opacity-50 cursor-pointer"
          >
            @if (isLoading()) {
              <lucide-icon
                name="Loader2"
                class="animate-spin"
                [size]="18"
              ></lucide-icon>
              Resetting...
            } @else {
              Reset Password
            }
          </button>
        </form>
      }
    </div>
  </div>
</div>
